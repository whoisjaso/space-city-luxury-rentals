---
phase: 08-admin-booking-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/src/pages/admin/DashboardPage.tsx
  - app/src/pages/admin/BookingsPage.tsx
  - app/src/components/admin/BookingTable.tsx
  - app/src/components/admin/DashboardStats.tsx
  - app/src/components/admin/BookingActionModal.tsx
  - app/src/hooks/useAdminBookings.ts
autonomous: true

must_haves:
  truths:
    - "Dashboard shows quick stats: total bookings, pending requests count, active vehicles count"
    - "Joey can view all booking requests in a table"
    - "Joey can filter bookings by status (all, pending, approved, declined)"
    - "Joey can approve or decline a booking with notes"
    - "Status changes appear immediately (optimistic update) and persist on refresh"
    - "Admin notes are visible to the customer when checking booking status"
  artifacts:
    - path: "app/src/pages/admin/DashboardPage.tsx"
      provides: "Admin dashboard with stats and recent bookings"
    - path: "app/src/pages/admin/BookingsPage.tsx"
      provides: "Booking management page with filtering"
    - path: "app/src/hooks/useAdminBookings.ts"
      provides: "Admin booking hooks with optimistic updates"
---

<objective>
Build the admin dashboard and booking management — stats overview, booking list with filtering, approve/decline with notes.

Purpose: Joey sees every booking in one place. The dashboard gives him a quick health check (total bookings, pending count, active vehicles). The bookings page lets him filter by status, review details, and approve or decline with notes that the customer can see on their status page.

Output: DashboardPage with stats, BookingsPage with table and actions, approve/decline modal with notes.
</objective>

<tasks>
<task id="1" name="Create admin dashboard, booking management, and hooks" type="code">
Create the following:

1. `app/src/hooks/useAdminBookings.ts`:
   - `useAdminBookings(statusFilter?: string)`: Fetch all bookings with vehicle name joined
     - If Supabase: `supabase.from('bookings').select('*, vehicles(name, slug)')` with optional status filter
     - Demo mode: return mock bookings array (3-5 demo bookings with various statuses)
   - `useAdminStats()`: Fetch dashboard stats
     - Total bookings count
     - Pending bookings count
     - Active vehicles count
     - Demo mode: return hardcoded stats
   - `useUpdateBookingStatus()`: Mutation to approve/decline with notes
     - Updates status and admin_notes fields
     - Optimistic update via queryClient.setQueryData
     - Demo mode: update local mock data
   - All hooks use supabaseConfigured check from lib/supabase.ts

2. `app/src/components/admin/DashboardStats.tsx`:
   - Three stat cards in a row (responsive grid)
   - Card 1: Total Bookings (calendar icon, number, "all time" subtitle)
   - Card 2: Pending Requests (clock icon, number, gold highlight if > 0)
   - Card 3: Active Vehicles (car icon, number)
   - Dark card backgrounds (#1a1a1a), white text, gold accent for pending
   - Loading skeleton state

3. `app/src/components/admin/BookingTable.tsx`:
   Props: { bookings, onAction: (bookingId, action) => void }
   - Table columns: Confirmation Code, Guest Name, Vehicle, Dates, Status, Actions
   - Status badges: pending (yellow/gold), approved (green), declined (red)
   - Action buttons: Approve (green), Decline (red) — only shown for pending bookings
   - Approved bookings show a "Decline" option, declined show "Approve" (allow status changes)
   - Click on row to expand details (email, phone, admin notes)
   - Mobile: card layout instead of table
   - Sort by date (newest first)

4. `app/src/components/admin/BookingActionModal.tsx`:
   Props: { booking, action: 'approve' | 'decline', onConfirm: (notes: string) => void, onCancel: () => void }
   - Modal overlay
   - Title: "Approve Booking" or "Decline Booking"
   - Shows booking summary (guest name, vehicle, dates)
   - Textarea for admin notes (optional for approve, encouraged for decline)
   - Placeholder text: "Add a note for the customer (optional)" or "Reason for declining (recommended)"
   - Confirm button (green for approve, red for decline)
   - Cancel button

5. Replace `app/src/pages/admin/DashboardPage.tsx` (currently placeholder):
   - Header: "Dashboard" with welcome message
   - DashboardStats component
   - "Recent Bookings" section showing last 5 bookings (mini table or card list)
   - Quick links: "View All Bookings", "Manage Vehicles"

6. Replace `app/src/pages/admin/BookingsPage.tsx` (currently placeholder):
   - Header: "Manage Bookings"
   - Status filter tabs/buttons: All, Pending, Approved, Declined
   - Pending count badge on the Pending tab
   - BookingTable component
   - BookingActionModal (shown when action button clicked)
   - Loading and empty states
   - Uses useAdminBookings with status filter
   - Uses useUpdateBookingStatus for approve/decline

Commit message: feat(08-01): admin dashboard with stats and booking management
</task>
</tasks>
