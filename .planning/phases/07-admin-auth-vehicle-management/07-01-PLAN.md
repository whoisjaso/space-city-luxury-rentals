---
phase: 07-admin-auth-vehicle-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/src/pages/admin/LoginPage.tsx
  - app/src/pages/admin/VehiclesPage.tsx
  - app/src/pages/admin/VehicleFormPage.tsx
  - app/src/layouts/AdminLayout.tsx
  - app/src/components/admin/AdminSidebar.tsx
  - app/src/components/admin/ProtectedRoute.tsx
  - app/src/components/admin/VehicleTable.tsx
  - app/src/components/admin/ImageUpload.tsx
  - app/src/hooks/useAdminVehicles.ts
  - app/src/App.tsx
autonomous: true

must_haves:
  truths:
    - "Joey can navigate to /admin and log in with email/password"
    - "Unauthenticated users visiting /admin are redirected to /admin/login"
    - "ProtectedRoute checks auth state and redirects if not authenticated"
    - "AdminLayout has a sidebar with navigation links (Dashboard, Vehicles, Bookings)"
    - "Joey can see a list of all vehicles in a table with name, price, status, actions"
    - "Joey can add a new vehicle with all fields (name, slug, headline, description, price, tags, images)"
    - "Joey can edit an existing vehicle's details"
    - "Joey can deactivate/delete a vehicle"
    - "Image upload component handles file selection and preview"
  artifacts:
    - path: "app/src/pages/admin/LoginPage.tsx"
      provides: "Admin login page"
    - path: "app/src/layouts/AdminLayout.tsx"
      provides: "Admin layout with sidebar"
    - path: "app/src/components/admin/ProtectedRoute.tsx"
      provides: "Auth guard for admin routes"
    - path: "app/src/pages/admin/VehiclesPage.tsx"
      provides: "Vehicle list/management page"
    - path: "app/src/pages/admin/VehicleFormPage.tsx"
      provides: "Add/edit vehicle form"
---

<objective>
Build the admin authentication and vehicle management system — login page, protected admin layout with sidebar, vehicle CRUD with image upload.

Purpose: Joey needs a private admin panel to manage his fleet. This includes secure login, a vehicle list with all management actions, and a form for adding/editing vehicles with all their details. The admin panel has its own layout (sidebar navigation) separate from the public site.

Output: Complete admin vehicle management — login, protected routes, vehicle list, add/edit/delete vehicles.
</objective>

<tasks>
<task id="1" name="Create admin auth, layout, and vehicle management" type="code">
Create the following:

1. `app/src/components/admin/ProtectedRoute.tsx`:
   - Uses useAuth() hook to check authentication
   - If loading: show loading spinner
   - If not authenticated: redirect to /admin/login
   - If authenticated: render children (Outlet)

2. `app/src/pages/admin/LoginPage.tsx`:
   - Clean, centered login form
   - Space City logo at top
   - Email and password fields
   - "Sign In" button (gold background)
   - Error message display for invalid credentials
   - If already authenticated, redirect to /admin
   - Uses useAuth().signIn() for login
   - In demo mode (no Supabase): show a notice that admin requires Supabase configuration

3. `app/src/components/admin/AdminSidebar.tsx`:
   - Fixed sidebar on left (w-64)
   - Logo at top linking to /admin
   - Navigation links:
     - Dashboard (/admin) — with chart icon
     - Vehicles (/admin/vehicles) — with car icon
     - Bookings (/admin/bookings) — with calendar icon
   - Active link highlighted with gold accent
   - "View Site" link at bottom (opens / in new tab)
   - Sign out button at bottom
   - Collapsible on mobile (hamburger toggle)
   - Use lucide-react icons

4. `app/src/layouts/AdminLayout.tsx`:
   - Flex layout: AdminSidebar on left + main content area on right
   - Main content: pl-64 on desktop (sidebar width), full width on mobile
   - Dark background (#0a0a0a)
   - Outlet for nested routes

5. `app/src/hooks/useAdminVehicles.ts`:
   - `useAdminVehicles()`: Fetch ALL vehicles (including inactive) for admin
   - `useCreateVehicle()`: Mutation to insert new vehicle
   - `useUpdateVehicle()`: Mutation to update vehicle by id
   - `useDeleteVehicle()`: Mutation to soft-delete (set is_active = false) or hard delete
   - `useUploadVehicleImage()`: Mutation to upload image to Supabase Storage vehicle-images bucket
   - All with demo mode fallback (optimistic local state updates)

6. `app/src/components/admin/VehicleTable.tsx`:
   - Table displaying all vehicles
   - Columns: Image (thumbnail), Name, Daily Price, Status (active/inactive badge), Tags, Actions
   - Actions: Edit button (links to /admin/vehicles/edit/:id), Toggle active/inactive, Delete
   - Sort by name or price
   - Search/filter by name
   - Responsive: cards on mobile instead of table

7. `app/src/components/admin/ImageUpload.tsx`:
   - Drag-and-drop or click-to-upload area
   - Shows preview thumbnails of selected/uploaded images
   - Remove button on each preview
   - Accepts jpg, png, webp
   - Max file size indicator
   - In demo mode: just show local file previews (no actual upload)

8. `app/src/pages/admin/VehiclesPage.tsx`:
   - Header: "Manage Vehicles" + "Add Vehicle" button (links to /admin/vehicles/new)
   - VehicleTable component
   - Uses useAdminVehicles hook

9. `app/src/pages/admin/VehicleFormPage.tsx`:
   - Dual purpose: Add new vehicle OR edit existing
   - If URL has :id param, load vehicle data and pre-fill form
   - Form fields:
     - Name (text)
     - Slug (auto-generated from name, editable)
     - Headline (text — identity tagline)
     - Description (textarea)
     - Daily price (number input, displayed as dollars, stored as cents)
     - Experience tags (multi-select checkboxes for the 6 tags)
     - Images (ImageUpload component)
     - Is Active (toggle switch)
   - Save button (gold)
   - Cancel button (links back to /admin/vehicles)
   - Form validation (name, slug, price required)
   - On save: create or update vehicle, redirect to vehicles list

10. Update `app/src/App.tsx`:
    - Add admin routes:
      - /admin/login → LoginPage (no layout)
      - /admin → ProtectedRoute wrapping AdminLayout
        - /admin (index) → placeholder DashboardPage (Phase 8)
        - /admin/vehicles → VehiclesPage
        - /admin/vehicles/new → VehicleFormPage
        - /admin/vehicles/edit/:id → VehicleFormPage
        - /admin/bookings → placeholder BookingsPage (Phase 8)

Commit message: feat(07-01): admin auth, layout, and vehicle management CRUD
</task>
</tasks>
