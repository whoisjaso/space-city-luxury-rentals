---
phase: 01-routing-and-animation-survival
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - app/src/sections/Hero.tsx
  - app/src/sections/About.tsx
  - app/src/sections/Exhibitions.tsx
  - app/src/sections/Collections.tsx
  - app/src/sections/Testimonials.tsx
  - app/src/sections/Visit.tsx
autonomous: true

must_haves:
  truths:
    - "All 6 section components use useGSAP instead of useEffect for GSAP animations"
    - "No section component has a conditional return before any hook call (Rules of Hooks compliant)"
    - "No section component has a triggersRef array for manual cleanup"
    - "No section component calls gsap.registerPlugin directly (uses centralized lib/gsap.ts)"
    - "All section components use scope parameter to restrict selector queries to their own DOM subtree"
  artifacts:
    - path: "app/src/sections/Hero.tsx"
      provides: "Hero section with useGSAP-managed entrance animation and scroll parallax"
      contains: "useGSAP"
    - path: "app/src/sections/About.tsx"
      provides: "About section with useGSAP-managed text reveals, gallery parallax, image reveals, stat reveals"
      contains: "useGSAP"
    - path: "app/src/sections/Exhibitions.tsx"
      provides: "Exhibitions section with useGSAP-managed header reveals, card reveals, CTA reveal"
      contains: "useGSAP"
    - path: "app/src/sections/Collections.tsx"
      provides: "Collections section with useGSAP-managed stacking card pins, dim triggers, text reveals"
      contains: "useGSAP"
    - path: "app/src/sections/Testimonials.tsx"
      provides: "Testimonials section with useGSAP-managed reveal items"
      contains: "useGSAP"
    - path: "app/src/sections/Visit.tsx"
      provides: "Visit section with useGSAP-managed info card reveals"
      contains: "useGSAP"
  key_links:
    - from: "all section components"
      to: "app/src/lib/gsap.ts"
      via: "import { gsap, ScrollTrigger, useGSAP } from '../lib/gsap'"
      pattern: "from\\s+['\"]\\.\\.\/lib\/gsap['\"]"
---

<objective>
Migrate all 6 section components from useEffect-based GSAP animation management to the useGSAP hook from @gsap/react.

Purpose: The useGSAP hook wraps all GSAP animations in gsap.context(), which automatically reverts ALL property changes (not just kills triggers) on unmount. This is essential for React Router navigation -- when the user navigates away from the landing page and back, animations must cleanly tear down and re-initialize without memory leaks, orphaned ScrollTriggers, or wrong initial CSS states. This also fixes StrictMode double-mount issues.

Output: All 6 section components using useGSAP with scope, no manual cleanup arrays, no Rules of Hooks violations, no direct gsap.registerPlugin calls.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-routing-and-animation-survival/01-RESEARCH.md
@.planning/phases/01-routing-and-animation-survival/01-01-SUMMARY.md

Source files to migrate:
@app/src/sections/Hero.tsx
@app/src/sections/About.tsx
@app/src/sections/Exhibitions.tsx
@app/src/sections/Collections.tsx
@app/src/sections/Testimonials.tsx
@app/src/sections/Visit.tsx

Centralized GSAP (created in Plan 01):
@app/src/lib/gsap.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate Hero, About, and Exhibitions to useGSAP</name>
  <files>
    app/src/sections/Hero.tsx
    app/src/sections/About.tsx
    app/src/sections/Exhibitions.tsx
  </files>
  <action>
    Apply the same migration pattern to each of these 3 components. For each component:

    **Step 1: Update imports**
    - Remove: `import { useEffect, useRef } from 'react'` -- change to `import { useRef } from 'react'` (remove useEffect since we no longer need it for GSAP)
    - Remove: `import { gsap } from 'gsap'` and `import { ScrollTrigger } from 'gsap/ScrollTrigger'`
    - Add: `import { gsap, ScrollTrigger, useGSAP } from '../lib/gsap'`
    - Remove: the standalone `gsap.registerPlugin(ScrollTrigger)` call

    **Step 2: Replace useEffect with useGSAP**
    - Change `useEffect(() => { ... }, [])` to `useGSAP(() => { ... }, { scope: sectionRef })`
    - Remove the entire `triggersRef` declaration (`const triggersRef = useRef<ScrollTrigger[]>([])`)
    - Remove ALL `triggersRef.current.push(...)` lines inside the callback
    - Remove the entire cleanup return function (`return () => { triggersRef.current.forEach(...) }`)
    - In Hero.tsx, also remove `tl.kill()` from the cleanup -- useGSAP handles it
    - Keep ALL animation logic (gsap.set, gsap.to, ScrollTrigger.create, gsap.timeline) exactly as-is

    **Step 3: Fix Rules of Hooks violation**
    - Move the conditional return (`if (!config...) return null;`) to AFTER the useGSAP call
    - In Hero.tsx: move `if (!heroConfig.brandLeft && !heroConfig.brandRight) return null;` to after useGSAP
    - In About.tsx: move `if (!aboutConfig.headline) return null;` to after useGSAP
    - In Exhibitions.tsx: move `if (!exhibitionsConfig.headline && exhibitionsConfig.exhibitions.length === 0) return null;` to after useGSAP
    - All refs must be declared before useGSAP. The conditional return goes between useGSAP and the JSX return.

    **Hero.tsx specific notes:**
    - The entrance timeline (`gsap.timeline({ delay: 0.3 })`) stays inside useGSAP unchanged
    - The scroll parallax `ScrollTrigger.create()` stays inside useGSAP unchanged
    - Remove `triggersRef` entirely -- useGSAP's context tracks the ScrollTrigger automatically
    - The `scope: sectionRef` parameter scopes all queries to the hero section

    **About.tsx specific notes:**
    - The text reveal, gallery parallax, image reveal, and stat reveal sections all stay inside ONE useGSAP callback
    - All DOM queries (`text.querySelectorAll('.reveal-text')`, `gallery.querySelectorAll('.gallery-col')`, etc.) stay as-is since they query within refs
    - Remove all `triggersRef.current.push(trigger)` lines (there are many -- around 4 groups of them)

    **Exhibitions.tsx specific notes:**
    - Header reveal, card reveal, and CTA reveal all stay inside ONE useGSAP callback
    - Remove all `triggersRef.current.push(trigger)` lines
  </action>
  <verify>
    - Search each file for `useEffect` -- should NOT appear (no useEffect for GSAP)
    - Search each file for `triggersRef` -- should NOT appear
    - Search each file for `gsap.registerPlugin` -- should NOT appear
    - Search each file for `useGSAP` -- should appear exactly once per file
    - Search each file for `from '../lib/gsap'` -- should appear once per file
    - Verify conditional returns appear AFTER useGSAP call in each file
    - Run `cd app && npm run build` -- should pass without errors
  </verify>
  <done>
    Hero.tsx, About.tsx, and Exhibitions.tsx all use useGSAP with scope, have no manual cleanup, no triggersRef, no Rules of Hooks violations, and import from centralized lib/gsap.ts. Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate Collections, Testimonials, and Visit to useGSAP</name>
  <files>
    app/src/sections/Collections.tsx
    app/src/sections/Testimonials.tsx
    app/src/sections/Visit.tsx
  </files>
  <action>
    Apply the same migration pattern as Task 1 to each of these 3 components.

    **For all three, apply the same Steps 1-3 from Task 1:**
    - Update imports (remove useEffect from react import, use centralized lib/gsap.ts, remove gsap.registerPlugin)
    - Replace useEffect with useGSAP using `{ scope: sectionRef }`
    - Remove triggersRef and all push/cleanup code
    - Move conditional return after useGSAP call

    **Collections.tsx specific notes (MOST COMPLEX -- pay careful attention):**

    This component has the most complex ScrollTrigger setup with stacking cards:
    - `pin: true` with `pinSpacing: false` on each card except the last
    - Cross-card references: `endTrigger: cards[i + 1]`
    - Dim triggers referencing adjacent cards
    - Text reveal triggers inside each card

    All of this stays inside ONE useGSAP callback, exactly as-is. The useGSAP context will track all ScrollTrigger instances (pin triggers, dim triggers, text triggers) and revert them all on unmount.

    The `cardsRef` uses a callback ref pattern (`ref={(el) => { if (el) cardsRef.current[index] = el; }}`). This is fine -- the refs are populated before useGSAP runs because useGSAP runs after mount (same timing as useEffect).

    Move `if (!collectionsConfig.headline && collectionsConfig.collections.length === 0) return null;` to after useGSAP.

    Add `ScrollTrigger.refresh()` at the END of the useGSAP callback (after all triggers are created) to ensure pin spacing calculations are correct:
    ```typescript
    useGSAP(() => {
      // ... all existing animation code ...

      // Refresh after all pin triggers are created to ensure correct calculations
      ScrollTrigger.refresh();
    }, { scope: sectionRef });
    ```

    **Testimonials.tsx specific notes:**
    - Simple reveal animations on `.reveal-item` elements
    - Move `if (!testimonialsConfig.quote) return null;` to after useGSAP

    **Visit.tsx specific notes:**
    - Simple reveal animations on `.info-card` elements
    - Move `if (!visitConfig.headline && visitConfig.infoCards.length === 0) return null;` to after useGSAP
  </action>
  <verify>
    - Search each file for `useEffect` -- should NOT appear
    - Search each file for `triggersRef` -- should NOT appear
    - Search each file for `gsap.registerPlugin` -- should NOT appear
    - Search each file for `useGSAP` -- should appear exactly once per file
    - Search each file for `from '../lib/gsap'` -- should appear once per file
    - Verify conditional returns appear AFTER useGSAP call in each file
    - Collections.tsx should contain `ScrollTrigger.refresh()` at the end of the useGSAP callback
    - Run `cd app && npm run build` -- should pass without errors
  </verify>
  <done>
    Collections.tsx, Testimonials.tsx, and Visit.tsx all use useGSAP with scope, have no manual cleanup, no triggersRef, no Rules of Hooks violations, and import from centralized lib/gsap.ts. Collections includes ScrollTrigger.refresh() for pin recalculation. Build passes.
  </done>
</task>

</tasks>

<verification>
1. `cd app && npm run build` completes without errors
2. Zero occurrences of `useEffect` in any section file for GSAP purposes (Footer.tsx has no useEffect and needs no changes)
3. Zero occurrences of `triggersRef` in any section file
4. Zero occurrences of `gsap.registerPlugin` in any section file
5. All 6 section files import from `'../lib/gsap'`
6. All 6 section files call `useGSAP` with `{ scope: sectionRef }`
7. All conditional returns (`if (!config...) return null`) appear AFTER all hook calls
</verification>

<success_criteria>
- All 6 section components migrated from useEffect to useGSAP
- No manual ScrollTrigger cleanup in any section (useGSAP context handles it)
- No Rules of Hooks violations (conditional returns after hooks)
- All GSAP imports from centralized lib/gsap.ts
- Build passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/01-routing-and-animation-survival/01-02-SUMMARY.md`
</output>
