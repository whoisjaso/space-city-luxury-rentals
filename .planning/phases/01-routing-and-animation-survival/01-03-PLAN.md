---
phase: 01-routing-and-animation-survival
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified:
  - app/src/pages/LandingPage.tsx
  - app/src/App.tsx
  - app/src/main.tsx
autonomous: false

must_haves:
  truths:
    - "User can visit root URL (/) and see the full landing page with all 7 sections, GSAP scroll animations, and Lenis smooth scrolling"
    - "User can navigate to a non-root URL (e.g., /fleet) and back to landing without animations doubling, breaking, or leaking memory"
    - "User can refresh the browser on any route without getting a 404 locally (and vercel.json handles production)"
    - "Lenis smooth scroll is active only on the landing page, not on other routes"
    - "Custom cursor is active only on the landing page"
    - "ScrollTrigger.getAll().length returns 0 after navigating away from landing page"
  artifacts:
    - path: "app/src/pages/LandingPage.tsx"
      provides: "Landing page component with all 7 sections, Lenis, custom cursor, background transitions, and nuclear cleanup"
      min_lines: 60
    - path: "app/src/App.tsx"
      provides: "Thin router shell with Routes and Route components"
      min_lines: 10
    - path: "app/src/main.tsx"
      provides: "Entry point wrapping App in BrowserRouter and StrictMode"
      contains: "BrowserRouter"
  key_links:
    - from: "app/src/main.tsx"
      to: "app/src/App.tsx"
      via: "BrowserRouter wraps App"
      pattern: "BrowserRouter.*App"
    - from: "app/src/App.tsx"
      to: "app/src/pages/LandingPage.tsx"
      via: "Route path=\"/\" element={<LandingPage />}"
      pattern: "Route.*path=\"/\".*LandingPage"
    - from: "app/src/pages/LandingPage.tsx"
      to: "all section components"
      via: "direct import and render"
      pattern: "import.*from.*sections/"
    - from: "app/src/pages/LandingPage.tsx"
      to: "ScrollTrigger.getAll().forEach"
      via: "nuclear cleanup on unmount"
      pattern: "ScrollTrigger\\.getAll\\(\\)\\.forEach"
---

<objective>
Create the LandingPage component, restructure App.tsx as a router shell, and wire up React Router in main.tsx.

Purpose: This is the core routing integration. The current App.tsx becomes a thin router shell, and its content moves to a new LandingPage.tsx page component. React Router's BrowserRouter wraps everything so routes can be added in later phases. The landing page owns its own Lenis, custom cursor, and background transitions -- scoped so they don't leak to other routes. A nuclear ScrollTrigger cleanup ensures zero orphaned triggers after navigation.

Output: Working React Router integration where the landing page renders at "/" with identical behavior to pre-routing state, catch-all redirect handles unknown routes, and the architecture is ready for Phase 2+ route additions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-routing-and-animation-survival/01-RESEARCH.md
@.planning/phases/01-routing-and-animation-survival/01-01-SUMMARY.md
@.planning/phases/01-routing-and-animation-survival/01-02-SUMMARY.md

Source files:
@app/src/App.tsx
@app/src/main.tsx
@app/src/App.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create LandingPage.tsx and restructure App.tsx and main.tsx for routing</name>
  <files>
    app/src/pages/LandingPage.tsx
    app/src/App.tsx
    app/src/main.tsx
  </files>
  <action>
    **A. Create `app/src/pages/LandingPage.tsx`:**

    Create the `pages/` directory and the LandingPage component. This file takes ALL the content from the current App.tsx (hooks, sections, background color transitions) and moves it into a page-level component.

    ```typescript
    import { useEffect, useRef } from 'react';
    import { gsap, ScrollTrigger, useGSAP } from '../lib/gsap';
    import { siteConfig } from '../config';

    // Hooks
    import useLenis from '../hooks/useLenis';
    import useCustomCursor from '../hooks/useCustomCursor';

    // Sections
    import Hero from '../sections/Hero';
    import About from '../sections/About';
    import Exhibitions from '../sections/Exhibitions';
    import Collections from '../sections/Collections';
    import Testimonials from '../sections/Testimonials';
    import Visit from '../sections/Visit';
    import Footer from '../sections/Footer';

    function LandingPage() {
      const mainRef = useRef<HTMLDivElement>(null);

      // Lenis ONLY for landing page -- destroys on unmount, native scroll resumes
      useLenis();

      // Custom cursor ONLY for landing page
      useCustomCursor();

      // Set document metadata
      useEffect(() => {
        if (siteConfig.language) {
          document.documentElement.lang = siteConfig.language;
        }
        if (siteConfig.title) {
          document.title = siteConfig.title;
        }
      }, []);

      // Background color transitions -- using useGSAP for automatic cleanup
      useGSAP(() => {
        const sections = [
          { selector: '#hero-section', color: '#8c8c91' },
          { selector: '#about', color: '#050505' },
          { selector: '#exhibitions', color: '#050505' },
          { selector: '#collections', color: '#f0f0f0' },
          { selector: '#testimonials-section', color: '#8c8c91' },
          { selector: '#contact', color: '#050505' },
          { selector: '#footer-section', color: '#8c8c91' },
        ];

        sections.forEach(({ selector, color }) => {
          const el = document.querySelector(selector);
          if (!el) return;

          ScrollTrigger.create({
            trigger: el,
            start: 'top 60%',
            end: 'bottom 40%',
            onEnter: () => {
              gsap.to('body', { backgroundColor: color, duration: 0.6, ease: 'power2.out' });
            },
            onEnterBack: () => {
              gsap.to('body', { backgroundColor: color, duration: 0.6, ease: 'power2.out' });
            },
          });
        });
      }, { scope: mainRef });

      // Nuclear cleanup on unmount: catch ANY orphaned triggers from all child sections
      useEffect(() => {
        return () => {
          ScrollTrigger.getAll().forEach((t) => t.kill());
          ScrollTrigger.clearMatchMedia();
          // Reset body background to default dark color
          document.body.style.backgroundColor = '#050505';
        };
      }, []);

      return (
        <div ref={mainRef} className="relative">
          {/* Hero Section */}
          <div id="hero-section">
            <Hero />
          </div>

          {/* About Section */}
          <About />

          {/* Exhibitions Section */}
          <Exhibitions />

          {/* Collections Section */}
          <Collections />

          {/* Testimonials Section */}
          <div id="testimonials-section">
            <Testimonials />
          </div>

          {/* Visit Section */}
          <Visit />

          {/* Footer */}
          <div id="footer-section">
            <Footer />
          </div>
        </div>
      );
    }

    export default LandingPage;
    ```

    **B. Rewrite `app/src/App.tsx`:**

    Replace the entire file with a thin router shell:

    ```typescript
    import { Routes, Route, Navigate } from 'react-router';
    import './App.css';
    import LandingPage from './pages/LandingPage';

    function App() {
      return (
        <Routes>
          <Route path="/" element={<LandingPage />} />
          {/* Catch-all: redirect unknown routes to landing page */}
          <Route path="*" element={<Navigate to="/" replace />} />
        </Routes>
      );
    }

    export default App;
    ```

    Remove ALL existing imports (gsap, ScrollTrigger, useEffect, useRef, config, hooks, sections). The ONLY imports should be react-router, App.css, and LandingPage.

    **C. Update `app/src/main.tsx`:**

    Wrap App in BrowserRouter:

    ```typescript
    import { StrictMode } from 'react';
    import { createRoot } from 'react-dom/client';
    import { BrowserRouter } from 'react-router';
    import './index.css';
    import App from './App.tsx';

    createRoot(document.getElementById('root')!).render(
      <StrictMode>
        <BrowserRouter>
          <App />
        </BrowserRouter>
      </StrictMode>,
    );
    ```

    IMPORTANT:
    - Import `BrowserRouter` from `'react-router'` (NOT `'react-router-dom'` which is deprecated in v7)
    - Import `Routes`, `Route`, `Navigate` from `'react-router'` (NOT `'react-router-dom'`)
    - Keep `StrictMode` -- do NOT remove it. The useGSAP migration from Plan 02 correctly handles double-mount.
  </action>
  <verify>
    - Confirm `app/src/pages/LandingPage.tsx` exists and contains all section imports, useLenis, useCustomCursor, useGSAP for background transitions, and nuclear cleanup
    - Confirm `app/src/App.tsx` is a thin router shell with ONLY Routes/Route/Navigate -- no gsap imports, no hooks, no section imports
    - Confirm `app/src/main.tsx` wraps App in BrowserRouter
    - Confirm all react-router imports are from `'react-router'` (NOT `'react-router-dom'`)
    - Run `cd app && npm run build` -- should pass without errors
    - Run `cd app && npm run dev` to start dev server (will be checked in next task)
  </verify>
  <done>
    LandingPage.tsx contains all landing page content with scoped Lenis, cursor, and nuclear cleanup. App.tsx is a thin router shell. main.tsx wraps in BrowserRouter. Build passes.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete React Router integration with GSAP animation lifecycle management:
    - React Router v7 in Declarative mode (BrowserRouter)
    - All 6 section components migrated from useEffect to useGSAP
    - Lenis smooth scroll scoped to landing page only
    - Custom cursor scoped to landing page only
    - Nuclear ScrollTrigger cleanup on landing page unmount
    - Bug fixes: useLenis ticker leak, cursor:none accessibility, Rules of Hooks
    - Vite config fixed for SPA routing
    - vercel.json for production deployment
  </what-built>
  <how-to-verify>
    Start the dev server and perform these checks:

    1. **Basic landing page:** Visit http://localhost:5173/ (or whatever port Vite shows). Verify:
       - All 7 sections render (Hero, About, Exhibitions, Collections, Testimonials, Visit, Footer)
       - Scroll down through the entire page -- all GSAP animations trigger (text reveals, gallery parallax, card stacking, stat reveals, etc.)
       - Background color transitions work (grey -> dark -> dark -> light -> grey -> dark -> grey)
       - Smooth scrolling (Lenis) is active
       - Custom cursor follows mouse (gold circle, expands on links/buttons)

    2. **Scroll animations detail check:**
       - Hero: entrance animation plays (statue fades in, text slides up, nav appears)
       - About: text reveals on scroll, gallery columns parallax at different speeds, stats fade in
       - Exhibitions: header reveals, cards slide up with opacity transition
       - Collections: cards stack/pin on scroll, previous card dims and scales down, text reveals inside each card
       - Testimonials: quote icon, quote text, and author fade in on scroll
       - Visit: info cards stagger-reveal on scroll

    3. **Navigation cycle (CRITICAL):** Open browser console (F12), then:
       - Type in the URL bar: http://localhost:5173/fleet (a non-existent route)
       - You should be redirected back to /
       - Scroll through the page again -- ALL animations should work identically to step 1
       - Open Console tab and type: `ScrollTrigger.getAll().length` -- confirm the number is reasonable (around 51, not doubling)

    4. **Memory leak check:** In browser console:
       - Navigate to http://localhost:5173/fleet (redirect to /)
       - Immediately check console for errors (should be none)
       - Navigate to /fleet again and back, repeat 3 times
       - `ScrollTrigger.getAll().length` should be the same number each time (not growing)

    5. **Browser refresh:** Refresh the page on / -- should reload correctly, not 404
  </how-to-verify>
  <resume-signal>Type "approved" if the landing page works identically to before routing was added, animations work after navigation cycles, and no memory leaks are observed. Otherwise describe any issues.</resume-signal>
</task>

</tasks>

<verification>
1. `cd app && npm run build` completes without errors
2. Landing page at / renders all 7 sections with working GSAP animations
3. Lenis smooth scroll active on landing page
4. Custom cursor active on landing page
5. Navigate to /fleet -> redirected to / -> animations still work
6. No ScrollTrigger memory leaks after navigation cycles
7. Browser refresh on / works correctly
8. No console errors during any of the above
</verification>

<success_criteria>
- Root URL shows the complete landing page identical to pre-routing state
- Navigation away and back does not break, double, or leak animations
- Browser refresh works on any route without 404
- INFRA-01 requirement is satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/01-routing-and-animation-survival/01-03-SUMMARY.md`
</output>
