---
phase: 01-routing-and-animation-survival
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/package.json
  - app/vite.config.ts
  - app/src/lib/gsap.ts
  - app/src/hooks/useLenis.ts
  - app/src/hooks/useScrollTrigger.ts
  - app/src/App.css
  - app/src/index.css
  - vercel.json
autonomous: true

must_haves:
  truths:
    - "npm install completes without errors and react-router, @gsap/react, lenis are in node_modules"
    - "@studio-freight/lenis is no longer in package.json"
    - "vite.config.ts uses base '/' (default) instead of './'"
    - "useLenis.ts stores ticker callback reference so it can be properly removed on cleanup"
    - "cursor:none only applies for devices with a precise pointer"
    - "gsap.registerPlugin is called once in lib/gsap.ts and nowhere else"
  artifacts:
    - path: "app/src/lib/gsap.ts"
      provides: "Centralized GSAP plugin registration"
      exports: ["gsap", "ScrollTrigger", "useGSAP"]
    - path: "vercel.json"
      provides: "SPA rewrite rule for Vercel deployment"
      contains: "rewrites"
  key_links:
    - from: "app/src/lib/gsap.ts"
      to: "gsap, gsap/ScrollTrigger, @gsap/react"
      via: "import and registerPlugin"
      pattern: "gsap\\.registerPlugin\\(ScrollTrigger,\\s*useGSAP\\)"
---

<objective>
Install new dependencies, fix existing bugs, and set up foundational configuration for routing integration.

Purpose: All prerequisite changes must be in place before migrating section components to useGSAP or adding React Router. This plan handles dependency installation, vite config correction, bug fixes (useLenis ticker leak, useScrollTrigger infinite recreation, cursor:none accessibility), centralized GSAP plugin registration, and Vercel SPA deployment config.

Output: Clean dependency tree, all known bugs fixed, centralized GSAP exports ready for section migration, vercel.json ready for deployment.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-routing-and-animation-survival/01-RESEARCH.md

Key source files:
@app/package.json
@app/vite.config.ts
@app/src/hooks/useLenis.ts
@app/src/hooks/useScrollTrigger.ts
@app/src/App.css
@app/src/index.css
@app/src/lib/utils.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies, fix vite config, and create vercel.json</name>
  <files>
    app/package.json
    app/vite.config.ts
    vercel.json
  </files>
  <action>
    1. Run the following commands from the `app/` directory:
       ```
       npm install react-router@^7 @gsap/react@^2 lenis@^1.3
       npm uninstall @studio-freight/lenis
       ```
    2. In `app/vite.config.ts`, remove the `base: './'` line entirely (the default is `'/'` which is correct for SPA routing). Keep everything else (plugins, resolve.alias) unchanged.

    3. Create `vercel.json` at the PROJECT ROOT (`D:/joeyrentalkimi/vercel.json`, NOT inside `app/`):
       ```json
       {
         "rewrites": [
           { "source": "/(.*)", "destination": "/index.html" }
         ]
       }
       ```

    IMPORTANT: Do NOT install `react-router-dom` (deprecated in v7, everything is in `react-router`). Do NOT install `@react-router/dev` (Framework mode plugin, not needed for Declarative mode).
  </action>
  <verify>
    - Run `cd app && npm ls react-router @gsap/react lenis` -- all three packages listed without errors
    - Run `cd app && npm ls @studio-freight/lenis 2>&1` -- should show "empty" or "not found"
    - Confirm `app/vite.config.ts` does NOT contain `base: './'`
    - Confirm `vercel.json` exists at project root (not inside app/)
    - Run `cd app && npm run build` to verify the build still succeeds with new dependencies
  </verify>
  <done>
    react-router@^7, @gsap/react@^2, and lenis@^1.3 are installed. @studio-freight/lenis is removed. vite.config.ts uses default base path. vercel.json exists at project root with SPA rewrite. Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix bugs and centralize GSAP registration</name>
  <files>
    app/src/lib/gsap.ts
    app/src/hooks/useLenis.ts
    app/src/hooks/useScrollTrigger.ts
    app/src/App.css
    app/src/index.css
  </files>
  <action>
    **A. Create centralized GSAP registration (`app/src/lib/gsap.ts`):**

    Create a new file that registers all GSAP plugins once and re-exports them:
    ```typescript
    import { gsap } from 'gsap';
    import { ScrollTrigger } from 'gsap/ScrollTrigger';
    import { useGSAP } from '@gsap/react';

    gsap.registerPlugin(ScrollTrigger, useGSAP);

    export { gsap, ScrollTrigger, useGSAP };
    ```

    **B. Fix `app/src/hooks/useLenis.ts`:**

    Three changes:
    1. Change the import from `import Lenis from '@studio-freight/lenis'` to `import Lenis from 'lenis'`
    2. Change the gsap/ScrollTrigger imports to use the centralized file: `import { gsap, ScrollTrigger } from '../lib/gsap'`
    3. Remove the standalone `gsap.registerPlugin(ScrollTrigger)` call (already registered centrally)
    4. Fix the ticker callback bug: store the callback in a variable so the SAME reference is used for both `gsap.ticker.add()` and `gsap.ticker.remove()`:
       ```typescript
       const rafCallback = (time: number) => {
         lenis.raf(time * 1000);
       };
       gsap.ticker.add(rafCallback);
       ```
       In the cleanup: `gsap.ticker.remove(rafCallback);`
    5. Add Lenis CSS class cleanup in the return function: `document.documentElement.classList.remove('lenis', 'lenis-smooth');`

    The full fixed hook should match the pattern in the RESEARCH.md "Bug 1" fix section.

    **C. Delete `app/src/hooks/useScrollTrigger.ts`:**

    This hook is unused (no component imports it) and has the dependency array bug. Delete the entire file. The `useGSAP` hook from `@gsap/react` replaces its purpose.

    Verify no imports reference this file:
    - Search the codebase for `useScrollTrigger` or `useParallax` imports. There should be none.

    **D. Fix `cursor: none` accessibility in `app/src/App.css`:**

    Replace the bare `cursor: none` on `a` (line 17) and `button` (line 22) with a media-queried version. The `a` block should become:
    ```css
    a {
      text-decoration: none;
    }
    ```
    The `button` block should be removed entirely (it only had `cursor: none`).

    Add a new block at the end of the file (before the reduced motion section):
    ```css
    /* Only hide system cursor for devices with a precise pointer (mouse) */
    @media (any-hover: hover) and (pointer: fine) {
      a {
        cursor: none;
      }
      button {
        cursor: none;
      }
    }
    ```

    **E. Fix `cursor: none` in `app/src/index.css`:**

    In the `body` rule (around line 69-74), remove `cursor: none;` from the body declaration.

    Add inside the `@layer base` block, after the body rule:
    ```css
    @media (any-hover: hover) and (pointer: fine) {
      body {
        cursor: none;
      }
    }
    ```
  </action>
  <verify>
    - Confirm `app/src/lib/gsap.ts` exists and exports gsap, ScrollTrigger, useGSAP
    - Confirm `app/src/hooks/useLenis.ts` imports from `lenis` (not `@studio-freight/lenis`) and from `../lib/gsap` (not directly from `gsap`)
    - Confirm `app/src/hooks/useLenis.ts` contains `gsap.ticker.remove(rafCallback)` using a stored variable reference
    - Confirm `app/src/hooks/useLenis.ts` cleanup removes Lenis CSS classes
    - Confirm `app/src/hooks/useScrollTrigger.ts` is deleted
    - Search codebase for `useScrollTrigger` or `useParallax` -- zero import results
    - Confirm `app/src/App.css` has NO bare `cursor: none` outside a media query
    - Confirm `app/src/index.css` body rule has NO `cursor: none` outside a media query
    - Run `cd app && npm run build` to verify build still passes
  </verify>
  <done>
    lib/gsap.ts provides centralized GSAP registration. useLenis.ts is fixed (correct import, stored ticker callback, CSS class cleanup). useScrollTrigger.ts is deleted. cursor:none is wrapped in @media (any-hover: hover) and (pointer: fine) in both CSS files. Build passes.
  </done>
</task>

</tasks>

<verification>
1. `cd app && npm run build` completes without errors
2. `cd app && npm ls react-router @gsap/react lenis` shows all three installed
3. `cd app && npm ls @studio-freight/lenis 2>&1` shows not found
4. No `gsap.registerPlugin` calls exist outside of `app/src/lib/gsap.ts`
5. No `@studio-freight/lenis` imports exist anywhere in the codebase
6. No bare `cursor: none` declarations exist outside media queries
7. `vercel.json` at project root contains rewrite rule
</verification>

<success_criteria>
- All three new packages installed, deprecated package removed
- vite.config.ts uses root-relative base path
- Three existing bugs fixed (useLenis ticker, useScrollTrigger deleted, cursor accessibility)
- GSAP plugins registered once centrally in lib/gsap.ts
- vercel.json deployed at project root
- Build passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/01-routing-and-animation-survival/01-01-SUMMARY.md`
</output>
