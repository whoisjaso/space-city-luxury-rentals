---
phase: 02-supabase-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/package.json
  - app/src/lib/supabase.ts
  - app/src/types/database.ts
  - app/src/providers/AuthProvider.tsx
  - app/src/providers/QueryProvider.tsx
  - app/src/App.tsx
  - app/src/main.tsx
  - app/.env.example
  - app/.env
autonomous: true

must_haves:
  truths:
    - "@supabase/supabase-js and @tanstack/react-query are installed in package.json"
    - "lib/supabase.ts creates and exports a Supabase client using environment variables"
    - ".env.example documents required VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY variables"
    - "types/database.ts exports TypeScript types for vehicles and bookings tables"
    - "AuthProvider provides auth state context (user, session, loading, signIn, signOut)"
    - "QueryProvider wraps app with TanStack QueryClientProvider"
    - "App.tsx wraps routes with AuthProvider and QueryProvider"
  artifacts:
    - path: "app/src/lib/supabase.ts"
      provides: "Supabase client singleton"
      exports: ["supabase"]
    - path: "app/src/types/database.ts"
      provides: "Database types for vehicles and bookings"
      exports: ["Vehicle", "Booking", "Database"]
    - path: "app/src/providers/AuthProvider.tsx"
      provides: "Auth context with Supabase auth"
      exports: ["AuthProvider", "useAuth"]
    - path: "app/src/providers/QueryProvider.tsx"
      provides: "TanStack Query client provider"
      exports: ["QueryProvider"]
---

<objective>
Install Supabase and TanStack Query dependencies, create the client configuration, TypeScript types for the database schema, auth context provider, and query provider. Wire everything into the app shell.

Purpose: Establishes all client-side infrastructure needed to communicate with Supabase. After this plan, the app can authenticate users, query data, and manage server state — all subsequent phases build on these primitives.

Output: Supabase client, database types, AuthProvider, QueryProvider, all wired into App.tsx.
</objective>

<tasks>
<task id="1" name="Install dependencies and create Supabase client with types" type="code">
Install @supabase/supabase-js and @tanstack/react-query. Create:

1. `app/.env.example` with:
   ```
   VITE_SUPABASE_URL=your-project-url
   VITE_SUPABASE_ANON_KEY=your-anon-key
   ```

2. `app/.env` with the same placeholder values (will be gitignored)

3. Add `.env` to `.gitignore` if not already there

4. `app/src/lib/supabase.ts`:
   - Import createClient from @supabase/supabase-js
   - Read VITE_SUPABASE_URL and VITE_SUPABASE_ANON_KEY from import.meta.env
   - Export the supabase client singleton
   - Type it with the Database type from types/database.ts

5. `app/src/types/database.ts` — Full TypeScript types matching the schema:

   **Vehicle type:**
   - id: string (uuid)
   - slug: string (unique, URL-friendly)
   - name: string (e.g., "Rolls-Royce Ghost")
   - headline: string (identity headline, e.g., "Move in Silence. Let the Car Do the Talking.")
   - description: string (full description)
   - daily_price_cents: number (integer, cents)
   - images: string[] (array of storage URLs)
   - experience_tags: string[] (e.g., ["Date Night", "Boss Move", "Statement"])
   - rental_count: number (social proof)
   - is_active: boolean
   - created_at: string (ISO timestamp)
   - updated_at: string (ISO timestamp)

   **Booking type:**
   - id: string (uuid)
   - confirmation_code: string (unique, 8-char alphanumeric)
   - vehicle_id: string (FK to vehicles)
   - guest_name: string
   - guest_email: string
   - guest_phone: string
   - start_date: string (date)
   - end_date: string (date)
   - status: 'pending' | 'approved' | 'declined'
   - admin_notes: string | null
   - terms_accepted: boolean
   - created_at: string (ISO timestamp)
   - updated_at: string (ISO timestamp)

   **Database type** for Supabase generic:
   - Tables: { vehicles: { Row, Insert, Update }, bookings: { Row, Insert, Update } }

6. `app/src/providers/AuthProvider.tsx`:
   - Create AuthContext with: user, session, loading, signIn(email, password), signOut()
   - Use supabase.auth.getSession() on mount
   - Listen to supabase.auth.onAuthStateChange
   - Export AuthProvider component and useAuth hook

7. `app/src/providers/QueryProvider.tsx`:
   - Create QueryClient with sensible defaults (staleTime: 5 min, retry: 1)
   - Export QueryProvider that wraps children with QueryClientProvider

8. Update `app/src/App.tsx`:
   - Wrap Routes with QueryProvider and AuthProvider
   - Keep existing Route structure

Commit message: feat(02-01): supabase client, types, auth and query providers
</task>
</tasks>
